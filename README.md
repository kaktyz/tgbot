# Telegram Bot

Это телеграм-бот на Rust, который предоставляет две основные функции:
1. Отображает текущий IP-адрес бота с сайта 2ip.ru (с резервным вариантом)
2. Генерирует случайное число

## Требования

- Rust 1.70 или выше
- Docker (для контейнеризации)
- Docker Compose (для удобного запуска)

## Установка

1. Установите Rust, если он еще не установлен:
   ```bash
   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
   ```

2. Склонируйте репозиторий:
   ```bash
   git clone <your-repo-url>
   cd telegram_bot
   ```

3. Установите зависимости:
   ```bash
   cargo build
   ```

## Настройка

1. Создайте файл `.env` на основе примера:
   ```bash
   cp .env.example .env
   ```

2. Отредактируйте файл `.env`, указав:
   - `BOT_TOKEN`: токен вашего бота из @BotFather
   - `CHAT_ID`: ID чата, в котором должен работать бот (бот будет игнорировать все сообщения из других чатов)
   - `RANDOM_MIN` и `RANDOM_MAX`: диапазон для генерации случайных чисел (опционально)

Бот автоматически загружает переменные окружения из файла `.env` при запуске.

## Запуск

### Локально

1. Создайте файл `.env` на основе примера и укажите свои значения:
   ```bash
   cp .env.example .env
   # Отредактируйте .env, указав свои значения
   ```

2. Запустите бота:
   ```bash
   cargo run
   ```

   Для более подробного логирования используйте:
   ```bash
   RUST_LOG=debug cargo run
   ```

   Или используйте предоставленный скрипт:
   ```bash
   ./run_bot.sh
   ```

### В Docker

1. Убедитесь, что Docker и Docker Compose установлены
2. Отредактируйте файл `.env`, указав свои значения
3. Запустите бота с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

## Тестирование

Для запуска тестов выполните:
```bash
cargo test
```

## Архитектура

Проект состоит из следующих основных компонентов:

- `src/main.rs`: Основной файл с логикой бота
- `Dockerfile`: Описание для создания Docker-образа
- `docker-compose.yml`: Конфигурация для запуска в Docker Compose
- `Cargo.toml`: Зависимости проекта и метаданные
- `tests/`: Тесты (в текущей реализации тесты находятся в основном файле)

## Функциональность

Бот предоставляет интерактивное меню с двумя кнопками:

1. "Получить IP" - запрашивает текущий IP-адрес бота с сайта 2ip.ru (с резервным вариантом через httpbin.org)
2. "Случайное число" - генерирует случайное число в заданном диапазоне

Бот проверяет ID чата и отвечает только в указанном чате.

## Переменные окружения

- `BOT_TOKEN`: Токен бота из @BotFather (обязательно)
- `CHAT_ID`: ID чата, в котором должен работать бот (обязательно)
- `RANDOM_MIN`: Минимальное значение для генерации случайного числа (по умолчанию: 1)
- `RANDOM_MAX`: Максимальное значение для генерации случайного числа (по умолчанию: 100)

## Структура проекта

```
.
├── src/
│   └── main.rs          # Основной файл с логикой бота
├── tests/               # Тесты
├── Cargo.toml           # Зависимости и метаданные проекта
├── Cargo.lock           # Фиксированные версии зависимостей
├── Dockerfile           # Docker-инструкции для контейнеризации
├── docker-compose.yml   # Конфигурация для Docker Compose
├── .env.example         # Пример файла с переменными окружения
├── .gitignore           # Файл исключений для Git
└── README.md            # Этот файл
```

## Тесты

Тесты проверяют:
- Генерацию случайных чисел в заданном диапазоне
- Обработку некорректных значений переменных окружения
- Обработку перепутанных значений MIN и MAX
- Правильность генерации случайных чисел

Для запуска тестов используйте команду `cargo test`.

## Docker

Проект может быть запущен в Docker-контейнере. Для этого:

1. Убедитесь, что Docker и Docker Compose установлены
2. Создайте файл `.env` с необходимыми переменными
3. Запустите: `docker-compose up --build`

## Особенности реализации

- Бот использует альтернативный сервис (httpbin.org) для получения IP-адреса, если основной (2ip.ru) недоступен
- Добавлены заголовки User-Agent для корректной работы с API
- Реализована надежная обработка callback-запросов от нажатия кнопок
- Добавлено подробное логирование для диагностики проблем

## Автор

Создано с использованием Rust и teloxide